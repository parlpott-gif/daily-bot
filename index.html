<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¦ Musk Tweet é¢„æµ‹äº¤æ˜“ç³»ç»Ÿ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f1419;
            color: #e7e9ea;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 1px solid #2f3336;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        h1 span {
            color: #1d9bf0;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: #16181c;
            border-radius: 16px;
            padding: 20px;
            border: 1px solid #2f3336;
        }
        
        .card h2 {
            font-size: 1.2rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card h2 .icon {
            font-size: 1.5rem;
        }
        
        .stats-row {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .stat-item {
            background: #1c1f23;
            padding: 15px 20px;
            border-radius: 12px;
            min-width: 120px;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #1d9bf0;
        }
        
        .stat-label {
            font-size: 0.85rem;
            color: #71767b;
            margin-top: 5px;
        }
        
        .trend-up {
            color: #00ba7c;
        }
        
        .trend-down {
            color: #f4212e;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #2f3336;
        }
        
        th {
            color: #71767b;
            font-weight: 500;
            font-size: 0.85rem;
        }
        
        .ev-positive {
            color: #00ba7c;
        }
        
        .ev-negative {
            color: #f4212e;
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: 20px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: #1d9bf0;
            color: white;
        }
        
        .btn-primary:hover {
            background: #1a8cd8;
        }
        
        .btn-success {
            background: #00ba7c;
            color: white;
        }
        
        .btn-success:hover {
            background: #00956a;
        }
        
        .btn-danger {
            background: #f4212e;
            color: white;
        }
        
        .config-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .config-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .config-item label {
            font-size: 0.85rem;
            color: #71767b;
        }
        
        .config-item input, .config-item select {
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #2f3336;
            background: #1c1f23;
            color: #e7e9ea;
            font-size: 1rem;
        }
        
        .toggle-container {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: #1c1f23;
            border-radius: 12px;
        }
        
        .toggle {
            position: relative;
            width: 50px;
            height: 26px;
        }
        
        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #f4212e;
            border-radius: 26px;
            transition: 0.3s;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background: white;
            border-radius: 50%;
            transition: 0.3s;
        }
        
        input:checked + .slider {
            background: #00ba7c;
        }
        
        input:checked + .slider:before {
            transform: translateX(24px);
        }
        
        .mode-badge {
            padding: 5px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .mode-auto {
            background: #00ba7c;
            color: white;
        }
        
        .mode-manual {
            background: #f4212e;
            color: white;
        }
        
        .refresh-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #1d9bf0;
            color: white;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(29, 155, 240, 0.4);
            transition: all 0.3s;
        }
        
        .refresh-btn:hover {
            transform: scale(1.1);
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #71767b;
        }
        
        .market-item {
            background: #1c1f23;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
        }
        
        .market-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .market-title {
            font-weight: 600;
        }
        
        .market-volume {
            color: #71767b;
            font-size: 0.9rem;
        }
        
        .outcome-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #2f3336;
        }
        
        .outcome-item:last-child {
            border-bottom: none;
        }
        
        .pnl-positive {
            color: #00ba7c;
        }
        
        .pnl-negative {
            color: #f4212e;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><span>ğŸ¦</span> Musk Tweet é¢„æµ‹äº¤æ˜“ç³»ç»Ÿ</h1>
            <p>åŸºäºå†å²æ•°æ®çš„æ¨æ–‡é¢„æµ‹ä¸å¸‚åœºäº¤æ˜“</p>
        </header>
        
        <!-- ç»Ÿè®¡æ•°æ® -->
        <div class="grid">
            <div class="card">
                <h2><span class="icon">ğŸ“Š</span> æ¨æ–‡ç»Ÿè®¡</h2>
                <div class="stats-row" id="tweetStats">
                    <div class="stat-item">
                        <div class="stat-value" id="avgTweets">-</div>
                        <div class="stat-label">æ—¥å‡æ¨æ–‡</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="maxTweets">-</div>
                        <div class="stat-label">æœ€é«˜å•æ—¥</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="todayTweets">-</div>
                        <div class="stat-label">ä»Šæ—¥æ–°å¢</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="trend">-</div>
                        <div class="stat-label">è¶‹åŠ¿</div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2><span class="icon">ğŸ’°</span> ç›ˆäºæ¦‚è§ˆ</h2>
                <div class="stats-row" id="pnlStats">
                    <div class="stat-item">
                        <div class="stat-value" id="totalPnl">-</div>
                        <div class="stat-label">æ€»ç›ˆäº</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="openOrders">-</div>
                        <div class="stat-label">å¼€ä»“ä¸­</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="closedOrders">-</div>
                        <div class="stat-label">å·²å¹³ä»“</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- å›¾è¡¨åŒºåŸŸ -->
        <div class="grid">
            <div class="card">
                <h2><span class="icon">ğŸ“ˆ</span> æ¨æ–‡è¶‹åŠ¿</h2>
                <canvas id="tweetChart"></canvas>
            </div>
            
            <div class="card">
                <h2><span class="icon">ğŸ“‰</span> æŒä»“ç›ˆäº</h2>
                <canvas id="pnlChart"></canvas>
            </div>
        </div>
        
        <!-- å¸‚åœºåˆ†æ -->
        <div class="card" style="margin-bottom: 20px;">
            <h2>
                <span class="icon">ğŸ¯</span> å¸‚åœº EV åˆ†æ
                <button class="btn btn-primary" onclick="scanMarkets()" style="margin-left: auto;">ğŸ”„ æ‰«æå¸‚åœº</button>
            </h2>
            <div id="marketsList">
                <div class="loading">ç‚¹å‡»æ‰«æè·å–å¸‚åœºæ•°æ®...</div>
            </div>
        </div>
        
        <!-- é…ç½® -->
        <div class="grid">
            <div class="card">
                <h2><span class="icon">âš™ï¸</span> äº¤æ˜“é…ç½®</h2>
                <div class="toggle-container" style="margin-bottom: 20px;">
                    <label class="toggle">
                        <input type="checkbox" id="autoMode" onchange="updateConfig()">
                        <span class="slider"></span>
                    </label>
                    <span>è‡ªåŠ¨åŒ–äº¤æ˜“æ¨¡å¼</span>
                    <span class="mode-badge mode-manual" id="modeBadge">æ‰‹åŠ¨</span>
                </div>
                
                <div class="config-grid">
                    <div class="config-item">
                        <label>æœ€å° EV é˜ˆå€¼ (%)</label>
                        <input type="number" id="minEv" value="5" onchange="updateConfig()">
                    </div>
                    <div class="config-item">
                        <label>æœ€å°ç›ˆåˆ©é˜ˆå€¼ (%)</label>
                        <input type="number" id="minProfit" value="10" onchange="updateConfig()">
                    </div>
                    <div class="config-item">
                        <label>æ­¢æŸçº¿ (%)</label>
                        <input type="number" id="stopLoss" value="-10" onchange="updateConfig()">
                    </div>
                    <div class="config-item">
                        <label>æ­¢ç›ˆçº¿ (%)</label>
                        <input type="number" id="takeProfit" value="30" onchange="updateConfig()">
                    </div>
                    <div class="config-item">
                        <label>å•æ¬¡ä¸‹å•é‡‘é¢ ($)</label>
                        <input type="number" id="positionSize" value="10" onchange="updateConfig()">
                    </div>
                    <div class="config-item">
                        <label>æœ€å¤§ä»“ä½ ($)</label>
                        <input type="number" id="maxPosition" value="100" onchange="updateConfig()">
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2><span class="icon">ğŸ“‹</span> è®¢å•è®°å½•</h2>
                <div style="max-height: 300px; overflow-y: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>å¸‚åœº</th>
                                <th>æ–¹å‘</th>
                                <th>ä»·æ ¼</th>
                                <th>ç›ˆäº</th>
                                <th>çŠ¶æ€</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTable">
                            <tr><td colspan="5" style="text-align: center; color: #71767b;">æš‚æ— è®¢å•</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <button class="refresh-btn" onclick="refreshAll()">â†»</button>
    
    <script>
        let tweetChart = null;
        let pnlChart = null;
        
        // åˆå§‹åŒ–
        async function init() {
            await loadConfig();
            await refreshAll();
        }
        
        // åˆ·æ–°æ‰€æœ‰æ•°æ®
        async function refreshAll() {
            await Promise.all([
                loadTweetData(),
                loadPnlData(),
                loadMarkets()
            ]);
        }
        
        // åŠ è½½é…ç½®
        async function loadConfig() {
            try {
                const res = await fetch('http://47.252.19.171:8443/api/config');
                const data = await res.json();
                
                if (data.config) {
                    document.getElementById('autoMode').checked = data.config.auto_mode;
                    document.getElementById('minEv').value = data.config.min_ev;
                    document.getElementById('minProfit').value = data.config.min_profit;
                    document.getElementById('stopLoss').value = data.config.stop_loss;
                    document.getElementById('takeProfit').value = data.config.take_profit;
                    document.getElementById('positionSize').value = data.config.position_size;
                    document.getElementById('maxPosition').value = data.config.max_position;
                    
                    updateModeBadge();
                }
            } catch (e) {
                console.error('Load config error:', e);
            }
        }
        
        // æ›´æ–°é…ç½®
        async function updateConfig() {
            const config = {
                auto_mode: document.getElementById('autoMode').checked,
                min_ev: parseFloat(document.getElementById('minEv').value),
                min_profit: parseFloat(document.getElementById('minProfit').value),
                stop_loss: parseFloat(document.getElementById('stopLoss').value),
                take_profit: parseFloat(document.getElementById('takeProfit').value),
                position_size: parseFloat(document.getElementById('positionSize').value),
                max_position: parseFloat(document.getElementById('maxPosition').value)
            };
            
            try {
                await fetch('http://47.252.19.171:8443/api/config', {
                    method: 'POST',
                    body: JSON.stringify(config)
                });
                updateModeBadge();
            } catch (e) {
                console.error('Update config error:', e);
            }
        }
        
        function updateModeBadge() {
            const isAuto = document.getElementById('autoMode').checked;
            const badge = document.getElementById('modeBadge');
            badge.textContent = isAuto ? 'è‡ªåŠ¨' : 'æ‰‹åŠ¨';
            badge.className = 'mode-badge ' + (isAuto ? 'mode-auto' : 'mode-manual');
        }
        
        // åŠ è½½æ¨æ–‡æ•°æ®
        async function loadTweetData() {
            try {
                const res = await fetch('http://47.252.19.171:8443/api/tweets');
                const data = await res.json();
                
                document.getElementById('avgTweets').textContent = data.stats.avg.toFixed(1);
                document.getElementById('maxTweets').textContent = data.stats.max;
                document.getElementById('todayTweets').textContent = data.today_count;
                
                const trendEl = document.getElementById('trend');
                const trend = data.trend;
                if (trend > 0) {
                    trendEl.textContent = 'â†‘ ' + trend.toFixed(1);
                    trendEl.className = 'stat-value trend-up';
                } else if (trend < 0) {
                    trendEl.textContent = 'â†“ ' + Math.abs(trend).toFixed(1);
                    trendEl.className = 'stat-value trend-down';
                } else {
                    trendEl.textContent = 'â†’ 0';
                    trendEl.className = 'stat-value';
                }
                
                // ç»˜åˆ¶å›¾è¡¨
                drawTweetChart(data.recent);
            } catch (e) {
                console.error('Load tweet data error:', e);
            }
        }
        
        function drawTweetChart(data) {
            const ctx = document.getElementById('tweetChart').getContext('2d');
            
            if (tweetChart) {
                tweetChart.destroy();
            }
            
            tweetChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.date.slice(5)),
                    datasets: [{
                        label: 'æ¨æ–‡æ•°',
                        data: data.map(d => d.count),
                        borderColor: '#1d9bf0',
                        backgroundColor: 'rgba(29, 155, 240, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            grid: { color: '#2f3336' },
                            ticks: { color: '#71767b' }
                        },
                        y: {
                            grid: { color: '#2f3336' },
                            ticks: { color: '#71767b' }
                        }
                    }
                }
            });
        }
        
        // åŠ è½½ç›ˆäºæ•°æ®
        async function loadPnlData() {
            try {
                const res = await fetch('http://47.252.19.171:8443/api/pnl');
                const data = await res.json();
                
                document.getElementById('totalPnl').textContent = data.summary.total_pnl.toFixed(1) + '%';
                document.getElementById('totalPnl').className = 'stat-value ' + (data.summary.total_pnl >= 0 ? 'trend-up' : 'trend-negative');
                document.getElementById('openOrders').textContent = data.summary.open_orders;
                document.getElementById('closedOrders').textContent = data.summary.closed_orders;
                
                // ç»˜åˆ¶ç›ˆäºå›¾è¡¨
                drawPnlChart(data.chart);
                
                // æ›´æ–°è®¢å•è¡¨
                updateOrdersTable(data.orders);
            } catch (e) {
                console.error('Load pnl data error:', e);
            }
        }
        
        function drawPnlChart(chartData) {
            const ctx = document.getElementById('pnlChart').getContext('2d');
            
            if (pnlChart) {
                pnlChart.destroy();
            }
            
            pnlChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: chartData.labels,
                    datasets: [{
                        label: 'ç›ˆäº %',
                        data: chartData.values,
                        backgroundColor: chartData.values.map(v => v >= 0 ? '#00ba7c' : '#f4212e')
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            grid: { color: '#2f3336' },
                            ticks: { color: '#71767b' }
                        },
                        y: {
                            grid: { color: '#2f3336' },
                            ticks: { color: '#71767b' }
                        }
                    }
                }
            });
        }
        
        function updateOrdersTable(orders) {
            const tbody = document.getElementById('ordersTable');
            
            if (!orders || orders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #71767b;">æš‚æ— è®¢å•</td></tr>';
                return;
            }
            
            tbody.innerHTML = orders.map(o => `
                <tr>
                    <td>${o.market.substring(0, 20)}...</td>
                    <td>${o.side}</td>
                    <td>${o.price.toFixed(2)}%</td>
                    <td class="${o.pnl >= 0 ? 'pnl-positive' : 'pnl-negative'}">${o.pnl.toFixed(1)}%</td>
                    <td>${o.status}</td>
                </tr>
            `).join('');
        }
        
        // åŠ è½½å¸‚åœº
        async function loadMarkets() {
            try {
                const res = await fetch('http://47.252.19.171:8443/api/markets');
                const data = await res.json();
                
                if (data.analysis && data.analysis.length > 0) {
                    renderMarkets(data.analysis);
                }
            } catch (e) {
                console.error('Load markets error:', e);
            }
        }
        
        function renderMarkets(analysis) {
            const container = document.getElementById('marketsList');
            
            container.innerHTML = analysis.map(r => `
                <div class="market-item">
                    <div class="market-header">
                        <div>
                            <div class="market-title">${r.market.title}</div>
                            <div class="market-volume">äº¤æ˜“é‡: $${r.market.volume.toLocaleString()}</div>
                        </div>
                        <span class="mode-badge ${r.best_ev > 0 ? 'mode-auto' : 'mode-manual'}">
                            æœ€ä½³ EV: ${r.best_ev.toFixed(1)}%
                        </span>
                    </div>
                    ${r.predictions.slice(0, 3).map(p => `
                        <div class="outcome-item">
                            <span>${p.outcome}</span>
                            <span>
                                å¸‚åœº ${p.market_price.toFixed(1)}% â†’ 
                                é¢„æµ‹ ${p.pred_prob.toFixed(1)}% = 
                                <span class="${p.ev_diff >= 0 ? 'ev-positive' : 'ev-negative'}">
                                    ${p.ev_diff >= 0 ? '+' : ''}${p.ev_diff.toFixed(1)}%
                                </span>
                            </span>
                        </div>
                    `).join('')}
                </div>
            `).join('');
        }
        
        // æ‰«æå¸‚åœº
        async function scanMarkets() {
            const btn = event.target;
            btn.textContent = 'æ‰«æä¸­...';
            btn.disabled = true;
            
            try {
                const res = await fetch('http://47.252.19.171:8443/api/scan', { method: 'POST' });
                const data = await res.json();
                
                if (data.analysis) {
                    renderMarkets(data.analysis);
                }
            } catch (e) {
                console.error('Scan error:', e);
            }
            
            btn.textContent = 'ğŸ”„ æ‰«æå¸‚åœº';
            btn.disabled = false;
        }
        
        // å¯åŠ¨
        init();
    </script>
</body>
</html>
